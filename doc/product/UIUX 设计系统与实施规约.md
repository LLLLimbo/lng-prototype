本设计旨在解决传统大宗商品贸易系统“操作繁琐、数据密度大、视觉陈旧”的痛点，打造**“清晰（Clarity）、高效（Efficiency）、信赖（Trust）”**的用户体验。

---

# LNG贸易系统 UI/UX 设计系统与实施规约 (V2.0)

## 1. 设计原则 (Design Principles)

1. **数据可视化与降噪**：LNG贸易涉及大量数字（重量、金额、气化率）。设计应通过排版层级突显核心数据，弱化次要信息，避免“Excel搬家”式的拥挤界面。
2. **状态透明化**：鉴于业务链条长（计划-订单-履约-结算），必须通过进度条、状态徽章（Badge）让用户一眼识别当前环节，特别是资金冻结与解冻状态。
3. **移动端场景化**：针对司机/押运员的户外强光环境，移动端界面需采用高对比度、大触控区设计，简化输入流程（OCR优先）。
4. **容错与引导**：在资金涉及、资质审核等高风险环节，提供清晰的校验反馈和操作引导（Wizard），而非单纯的报错。

---

## 2. 视觉识别系统 (Visual Identity)

### 2.1 色彩体系 (Color Palette)

采用**“深海蓝”**作为主色调，体现能源行业的稳重与科技感；搭配**“清澈绿”**代表清洁能源与通行状态。

| 用途 | 颜色名称 | 色值 (HEX) | 说明 |
| --- | --- | --- | --- |
| **主品牌色** | **LNG Blue** | `#0052CC` | 用于导航栏、主按钮、高亮文本。传递专业、冷静。 |
| **辅助色** | **Eco Teal** | `#00B8D9` | 用于数据图表、次级强调。代表液化天然气。 |
| **成功/通过** | **Success Green** | `#36B37E` | 用于“审批通过”、“已送达”、“资金到账”。 |
| **警告/进行中** | **Warning Orange** | `#FFAB00` | 用于“审批中”、“运输中”、“磅差异常”。 |
| **错误/驳回** | **Danger Red** | `#FF5630` | 用于“已驳回”、“资金不足”、“资质过期”。 |
| **中性色** | **Slate Grey** | `#42526E` | 用于正文文本。 |
| **背景色** | **Ice White** | `#F4F5F7` | 页面背景，通过灰度区分卡片层级。 |

### 2.2 字体与排版 (Typography)

* **中文字体**：PingFang SC (Mac), Microsoft YaHei (Windows), Noto Sans SC (Android)。
* **数字字体**：Roboto 或 DIN Alternate（用于金额、吨位显示，强调等宽易读）。
* **字号规范**：
* 一级标题 (Page Title): 24px, Bold
* 二级标题 (Card Title): 18px, Medium
* 正文 (Body): 14px, Regular
* 辅助文字 (Caption): 12px, Regular (灰色)



---

## 3. 核心组件库 (Component Library)

### 3.1 状态机可视化 (Status Visualization)

针对SRS中复杂的订单状态，设计统一的状态组件：

* **步骤条 (Stepper)**：用于详情页顶部。
* *[草稿] -> [审批中] -> [已批准/下单] -> [履约中] -> [已验收] -> [已结算]*
* *设计细节*：当前步骤高亮，已完成步骤为实心圆，失败步骤（如驳回）显示红色感叹号。


* **胶囊徽章 (Capsule Badge)**：用于表格列表。
* `待审核` (橙底白字)
* `执行中` (蓝底白字)
* `异常` (红底白字 + 闪烁动画效果可选)



### 3.2 复杂表单 (Complex Forms)

针对“申报用气计划”和“注册入驻”模块：

* **分步表单 (Step Form)**：
* 将长表单拆解为：*1. 基础信息 -> 2. 履约/运输 -> 3. 费用确认 -> 4. 提交*。


* **关联输入 (Interactive Input)**：
* 选择“气源点”后，自动带出“参考单价”；
* 输入“计划量”后，实时计算“预计货款”并显示“当前可用余额”，若余额不足，金额显示红色并提示“需充值”。


* **OCR 交互组件**：
* 上传图片区域显示“点击或拖拽上传磅单”。
* 上传后显示“识别中...”，随即展示识别结果字段（可编辑态），并高亮显示置信度低的数据提醒人工校对。



### 3.3 数据表格 (Data Tables)

* **操作列**：固定在最右侧。
* **批量操作**：表头左上角提供“批量通过”、“批量导出”按钮。
* **关键列高亮**：金额列右对齐并加粗；异常磅差列用红色文字标出。

---

## 4. 页面布局规范 (Layout Specification)

### 4.1 Web端 (管理控制台)

采用 **左右布局 (Side Navigation)** 结构：

* **左侧导航栏 (Sidebar)**：深色背景 (`#091E42`)。
* 一级菜单带图标：*工作台、计划管理、订单中心、资金结算、报表分析*。
* 根据角色（SRS 7.2）动态隐藏不可见菜单。


* **顶部栏 (Top Bar)**：白色背景。
* 显示全局搜索、消息通知（铃铛图标，带红点）、帮助文档、用户头像/组织名称。


* **内容区 (Content Area)**：
* **面包屑 (Breadcrumb)**：显示当前路径。
* **筛选区 (Filter Bar)**：折叠式高级搜索。
* **数据概览卡片**（仅在列表页）：如“待审核计划 (3)”、“今日已装车 (120吨)”。



### 4.2 移动端 (H5/App - 司机与现场)

采用 **底部标签栏 (Tab Bar)** 结构：

* **首页 (Home)**：今日任务卡片流（待装车/待卸车）。
* **扫一扫 (Scan)**：居中大按钮，用于快速扫描单据或车牌（扩展）。
* **我的 (Profile)**：个人资质有效期、历史记录。

**特殊交互**：

* **大卡片设计**：每个任务为一个卡片，显示：*站点名称、车牌号、预约时间*。
* **滑动操作**：列表项左滑可触发“快速电话联系”或“导航”。

---

## 5. 关键交互流程设计 (Key Interaction Flows)

### 5.1 计划申报与审批 (SRS 模块 4 & 5)

* **用户侧**：
* 界面展示“资金水位条”：[=============   ] 80% 已占用。
* 提交时弹出《确认函》模态框（Modal），列出：*货款、承运费、磅差规则*，需勾选“我已阅读并确认”方可点亮提交按钮。


* **市场部侧**：
* **分屏对比模式**：左侧显示计划详情，右侧显示审核表单。
* **快捷驳回**：点击“退回”时，下拉菜单提供常用语（如“资质过期”、“余额不足”），支持自定义补充。



### 5.2 订单履约与磅差处理 (SRS 模块 7)

* **磅单上传 (移动端)**：
* 1. 拍照/选图 -> 2. 自动裁剪/滤镜增强（针对昏暗磅房） -> 3. OCR识别填充 -> 4. 司机确认提交。




* **磅差异常 (调度中心)**：
* 当 `|装车-卸车| > 阈值` 时，订单详情页顶部出现红色横幅警告：**“检测到磅差异常（-500kg），请处理”**。
* 点击处理进入“结算量调整”弹窗，展示装/卸磅单对比图，输入“最终结算量”和“处理备注”。



### 5.3 资金与对账 (SRS 模块 10 & 11)

* **资金看板**：
* 使用**仪表盘图表**显示：可用余额 vs 冻结金额。
* 冻结金额可点击，钻取（Drill-down）到具体的冻结订单列表。


* **在线签章 (Mock体验)**：
* 在确认单页面，放置一个拟物化的“盖章”按钮。
* 点击后，播放盖章动画（印章落下），页面上的PDF预览图随即增加红色公章水印，状态变更为“已签章”。



---

## 6. 原型实施指引 (Implementation Guide)

### 6.1 角色视角的首页设计 (Dashboard)

为不同角色设计差异化的默认首页（Landing Page）：

1. **终端用户**：
* **核心关注**：气价趋势图（折线图）、快速申报入口（大按钮）、账户余额（大数字）、最新订单物流进度（地图/时间轴）。


2. **调度中心**：
* **核心关注**：履约看板（Kanban视图：待补录 -> 待装车 -> 运输中 -> 待验收）、今日异常报警列表。


3. **市场部**：
* **核心关注**：待审批计划列表、今日销量统计、客户余额不足预警。


4. **财务部**：
* **核心关注**：待确认收款、待开票申请、资金流水变动。



### 6.2 交互反馈规范

* **加载中 (Loading)**：表格加载使用骨架屏 (Skeleton Screen)，避免白屏闪烁。
* **操作成功**：顶部居中 Toast 提示，3秒消失。例：“计划已提交，资金已锁定”。
* **操作失败**：模态框 (Modal) 阻断，需用户手动关闭，明确告知错误原因。
* **空状态 (Empty State)**：当列表无数据时，不只显示“无数据”，应显示插画并提供“新建”按钮引导。

### 6.3 移动端特别优化

* **触控目标**：所有按钮高度不小于 44px。
* **输入键盘**：输入“吨位”或“金额”时，强制唤起数字键盘（Number Pad）。
* **弱网提示**：考虑到运输途中信号不稳定，提交操作若超时，应允许“保存到本地，待网络恢复后自动上传”。

---

## 7. 附录：图标系统建议 (Iconography)

* **计划/订单**：使用文件类图标 (File-Text, Clipboard)。
* **资金**：使用钱币类图标 (Credit-Card, Wallet)。
* **运输**：使用卡车 (Truck)、定位 (Map-Pin)。
* **气源/站点**：使用火焰 (Flame)、工厂 (Factory)。
* **异常/警告**：使用三角形感叹号 (Alert-Triangle)。

---

## 8. 设计令牌系统 (Design Tokens)

设计令牌是连接设计与 React 代码的桥梁，所有视觉属性均通过令牌引用，禁止硬编码。

### 8.1 间距系统 (Spacing)

采用 **4px 基准网格**，所有间距为 4 的倍数：

| 令牌名 | 值 | 用途 |
| --- | --- | --- |
| `--space-xs` | 4px | 紧凑元素内间距（Badge 内边距） |
| `--space-sm` | 8px | 表单元素间距、表格单元格内边距 |
| `--space-md` | 16px | 卡片内边距、段落间距 |
| `--space-lg` | 24px | 区块间距、卡片间距 |
| `--space-xl` | 32px | 页面区域分隔 |
| `--space-2xl` | 48px | 页面顶部/底部留白 |

### 8.2 圆角 (Border Radius)

| 令牌名 | 值 | 用途 |
| --- | --- | --- |
| `--radius-sm` | 4px | 按钮、输入框 |
| `--radius-md` | 8px | 卡片、弹窗 |
| `--radius-lg` | 12px | 大卡片、移动端卡片 |
| `--radius-full` | 9999px | 胶囊徽章、头像 |

### 8.3 阴影 (Elevation)

| 令牌名 | 值 | 用途 |
| --- | --- | --- |
| `--shadow-sm` | `0 1px 2px rgba(9,30,66,0.08)` | 卡片默认态 |
| `--shadow-md` | `0 4px 12px rgba(9,30,66,0.12)` | 卡片悬停态、下拉菜单 |
| `--shadow-lg` | `0 8px 24px rgba(9,30,66,0.16)` | 模态框、抽屉 |

### 8.4 断点 (Breakpoints)

| 令牌名 | 值 | 说明 |
| --- | --- | --- |
| `--bp-mobile` | 375px | 移动端最小宽度 |
| `--bp-tablet` | 768px | 平板/折叠侧边栏 |
| `--bp-desktop` | 1280px | 桌面端标准 |
| `--bp-wide` | 1440px | 宽屏优化 |

### 8.5 动效 (Motion)

| 令牌名 | 值 | 用途 |
| --- | --- | --- |
| `--duration-fast` | 150ms | 按钮状态切换、Tooltip |
| `--duration-normal` | 250ms | 面板展开/收起、页面切换 |
| `--duration-slow` | 400ms | 模态框进出、盖章动画 |
| `--easing-default` | `cubic-bezier(0.4, 0, 0.2, 1)` | 通用缓动 |

---

## 9. React 组件架构规范

### 9.1 推荐技术选型

| 层面 | 推荐方案 | 说明 |
| --- | --- | --- |
| UI 框架 | Ant Design 5.x | 企业级组件库，内置中文支持，与业务场景高度匹配 |
| 状态管理 | Zustand / React Query | Zustand 管理客户端状态；React Query 管理服务端缓存 |
| 路由 | React Router v6 | 支持嵌套路由、权限守卫、懒加载 |
| 样式方案 | CSS Modules + Ant Design Token | 组件级隔离 + 全局令牌覆盖 |
| 图表 | ECharts / AntV | 资金看板、气价趋势、磅差分布等可视化 |
| 移动端 | Ant Design Mobile | 司机/押运员 H5 端，与 Web 端设计语言统一 |

### 9.2 组件分层结构

```
src/
├── components/          # 通用基础组件（与业务无关）
│   ├── StatusBadge/     # 胶囊徽章
│   ├── StepProgress/    # 步骤条
│   ├── MoneyDisplay/    # 金额展示（右对齐、千分位、红色异常）
│   ├── FileUploader/    # 统一文件上传（含 OCR 触发）
│   ├── ConfirmModal/    # 确认弹窗（含条款勾选）
│   └── EmptyState/      # 空状态（插画 + 引导按钮）
│
├── features/            # 业务功能模块
│   ├── auth/            # 登录/注册/找回密码
│   ├── onboarding/      # 用户入驻与资质审核
│   ├── gas-price/       # 气价管理与浏览
│   ├── plan/            # 用气计划（申报/审批/详情）
│   ├── order/           # 订单（补录/履约/验收）
│   ├── finance/         # 资金（收款/余额/冻结/预存）
│   ├── reconciliation/  # 对账（对账单/确认单/签章）
│   ├── invoice/         # 发票（申请/开票/下载）
│   ├── settlement/      # 结算看板
│   ├── report/          # 报表与经营分析
│   ├── archive/         # 归档管理
│   └── exception/       # 异常处理（终止/变更/多退少补）
│
├── layouts/             # 布局组件
│   ├── AdminLayout/     # Web 端左右布局（Sidebar + TopBar + Content）
│   └── MobileLayout/    # 移动端底部 Tab 布局
│
├── hooks/               # 自定义 Hooks
│   ├── usePermission    # 权限判断
│   ├── useRoleMenu      # 角色菜单过滤
│   └── useFundAccount   # 资金账户状态
│
└── theme/               # 主题配置
    ├── tokens.ts        # 设计令牌 → Ant Design Token 映射
    └── overrides.ts     # 组件级样式覆盖
```

### 9.3 主题配置示例 (Ant Design Token 映射)

```typescript
// theme/tokens.ts
import type { ThemeConfig } from 'antd';

export const lngTheme: ThemeConfig = {
  token: {
    colorPrimary: '#0052CC',       // LNG Blue
    colorSuccess: '#36B37E',       // Success Green
    colorWarning: '#FFAB00',       // Warning Orange
    colorError: '#FF5630',         // Danger Red
    colorInfo: '#00B8D9',          // Eco Teal
    colorTextBase: '#42526E',      // Slate Grey
    colorBgLayout: '#F4F5F7',      // Ice White
    borderRadius: 4,
    fontFamily: '"PingFang SC", "Microsoft YaHei", "Noto Sans SC", sans-serif',
  },
  components: {
    Table: {
      headerBg: '#F4F5F7',
      rowHoverBg: '#E6F0FF',
    },
    Menu: {
      darkItemBg: '#091E42',
      darkSubMenuItemBg: '#0A2744',
    },
  },
};
```

---

## 10. 导航与信息架构 (Navigation & IA)

### 10.1 Web 端侧边栏菜单结构（按角色）

#### 气源发展 — 市场部

| 一级菜单 | 图标 | 二级菜单 |
| --- | --- | --- |
| 工作台 | Dashboard | 待办事项、今日概览 |
| 用户管理 | Users | 入驻审核、合同管理、用户等级 |
| 气价管理 | TrendingUp | 公共气价、一户一价 |
| 计划审批 | ClipboardCheck | 审批工作台、卸气点维护、当日计划表 |
| 订单中心 | FileText | 订单列表、成单管理 |
| 对账管理 | FileSearch | 对账单、确认单、上游对账存档 |
| 开票管理 | Receipt | 开票申请 |
| 报表分析 | BarChart | 计划统计、履约报表、收款报表 |
| 异常处理 | AlertTriangle | 终止申请、变更申请 |

#### 气源发展 — 调度中心

| 一级菜单 | 图标 | 二级菜单 |
| --- | --- | --- |
| 工作台 | Dashboard | 履约看板（Kanban）、今日异常 |
| 基础信息 | Database | 站点管理、车辆管理、人员管理 |
| 订单管理 | FileText | 订单补录、订单审核、批量导入 |
| 履约管理 | Truck | 装车确认、卸车确认、磅差处理 |
| 验收管理 | CheckCircle | 待验收、已验收 |
| 归档管理 | Archive | 归档列表 |

#### 气源发展 — 财务部

| 一级菜单 | 图标 | 二级菜单 |
| --- | --- | --- |
| 工作台 | Dashboard | 待确认收款、资金预警 |
| 收款管理 | CreditCard | 预存确认、到款确认、客户资金台账 |
| 对账管理 | FileSearch | 对账单复核、确认单复核 |
| 开票管理 | Receipt | 待开票、已开票、发票归档 |
| 结算中心 | Calculator | 结算看板、上游付款记录 |
| 报表分析 | BarChart | 收款与账龄、开票进度、结算总览 |

#### 终端用户

| 一级菜单 | 图标 | 二级菜单 |
| --- | --- | --- |
| 工作台 | Dashboard | 气价趋势、账户余额、最新订单 |
| 气价查看 | TrendingUp | 可见气价列表 |
| 用气计划 | Clipboard | 新建计划、我的计划 |
| 订单跟踪 | FileText | 订单列表、订单详情 |
| 资金管理 | Wallet | 账户余额、预存登记、资金流水 |
| 对账与发票 | FileSearch | 对账单/确认单、发票下载 |
| 基础信息 | Database | 站点管理、车辆管理、人员管理 |

#### 承运商管理员

| 一级菜单 | 图标 | 二级菜单 |
| --- | --- | --- |
| 工作台 | Dashboard | 今日任务、运输统计 |
| 车辆管理 | Truck | 车辆列表、资质维护 |
| 人员管理 | Users | 司机/押运员、证件管理 |
| 运输任务 | MapPin | 任务列表、历史记录 |

### 10.2 移动端底部 Tab 结构

#### 司机/押运员

| Tab | 图标 | 说明 |
| --- | --- | --- |
| 首页 | Home | 今日任务卡片流（待装车/待卸车） |
| 扫一扫 | Scan | 居中突出按钮，扫描单据/车牌 |
| 消息 | Bell | 系统通知、催办消息 |
| 我的 | User | 个人资质、历史记录、设置 |

### 10.3 面包屑规则

* 层级不超过 **4 级**：`首页 / 一级菜单 / 二级菜单 / 详情页`
* 详情页标题使用业务编号：如 `计划审批 / 审批工作台 / PL-20260209-001`
* 面包屑每一级均可点击返回

---

## 11. 通用交互模式库 (Interaction Patterns)

### 11.1 搜索与筛选 (Search & Filter)

**全局搜索（TopBar）**：
* 输入框支持模糊搜索，搜索范围：计划编号、订单编号、客户名称、车牌号
* 搜索结果按类型分组展示（计划 / 订单 / 客户），每组最多显示 5 条，底部"查看全部"

**列表页筛选栏**：
* 默认展示 **3-4 个高频筛选项**（日期范围、状态、客户/站点）
* "更多筛选"按钮展开高级筛选面板（折叠式，非弹窗）
* 已激活的筛选条件以 Tag 形式显示在筛选栏下方，支持单个移除或"清除全部"
* 筛选变更后自动触发查询，无需手动点击"搜索"按钮

### 11.2 文件上传 (File Upload)

**通用上传组件**：
* 拖拽区域：虚线边框，悬停时边框变为主色 `#0052CC`
* 支持格式提示：如"支持 JPG/PNG/PDF，单文件不超过 20MB"
* 上传进度：进度条 + 百分比
* 上传完成：缩略图预览（图片）或文件图标 + 文件名（PDF/Excel）
* 支持多文件上传，已上传文件列表可删除（未提交前）

**磅单 OCR 上传（移动端增强）**：
* 拍照按钮居中，占屏幕宽度 80%，高度 48px
* 拍照后自动裁剪引导框（矩形叠加层）
* 识别中：全屏 Loading + "正在识别磅单..."
* 识别结果：字段卡片式展示，置信度 < 80% 的字段标记橙色边框 + "请核对"提示
* 所有识别字段均可手动编辑

### 11.3 通知与消息 (Notification)

**消息中心（TopBar 铃铛图标）**：
* 未读消息显示红色圆点 + 数字（最大显示 99+）
* 点击展开下拉面板，分类 Tab：全部 / 审批 / 履约 / 资金 / 系统
* 每条消息：标题 + 摘要 + 时间 + 未读标记
* 点击消息跳转到对应业务页面

**操作反馈层级**：

| 级别 | 组件 | 场景 | 行为 |
| --- | --- | --- | --- |
| 轻量 | Toast (Message) | 保存成功、提交成功 | 顶部居中，3s 自动消失 |
| 中等 | Notification | 审批通过/退回通知 | 右上角弹出，5s 消失或手动关闭 |
| 阻断 | Modal | 操作失败、确认删除、资金操作确认 | 居中模态框，必须手动处理 |

### 11.4 确认与审批弹窗 (Confirmation)

**标准确认弹窗**：
* 标题：操作动词 + 对象（如"确认提交计划"）
* 内容：关键信息摘要（计划量、预计货款、占用金额）
* 底部：取消（灰色）+ 确认（主色），确认按钮需 **1 秒延迟可点击**（防误触）

**高风险确认弹窗**（资金操作、终止、变更）：
* 增加红色警告横幅
* 必须勾选"我已阅读并确认"复选框后，确认按钮方可点击
* 确认按钮使用红色（Danger Red `#FF5630`）

**审批弹窗（分屏模式替代方案）**：
* 抽屉 (Drawer) 从右侧滑入，宽度 480px
* 左侧保持列表/详情页可见，右侧抽屉内显示审批表单
* 审批表单：通过/退回 Radio + 原因（退回时必填，支持原因模板下拉 + 自定义补充）+ 备注

### 11.5 表格操作规范 (Table Actions)

**行内操作**：
* 操作列固定右侧，最多显示 **2 个常用操作**（如"查看"、"审批"），其余收入"更多"下拉菜单
* 危险操作（删除、终止）使用红色文字，并需二次确认

**批量操作**：
* 表头左侧复选框控制全选/反选
* 选中行后，表格上方浮现操作栏：`已选 N 项 | 批量通过 | 批量导出 | 取消选择`
* 批量操作前弹出确认弹窗，列出受影响的记录数

**表格数据格式**：
* 金额：右对齐，千分位分隔，保留 2 位小数，负数红色
* 重量（吨）：右对齐，保留 3 位小数
* 时间：`YYYY-MM-DD HH:mm` 格式
* 编号：左对齐，可点击跳转详情

### 11.6 导出与打印 (Export & Print)

* 导出按钮位于筛选栏右侧，支持 Excel / PDF 格式
* 导出范围：当前筛选结果（非全量）
* 大数据量导出（>1000 条）：异步导出 + 消息通知下载
* 打印：使用 `@media print` 样式，隐藏导航栏/操作按钮，仅保留数据内容

---

## 12. 权限驱动的 UI 渲染策略

### 12.1 三级权限控制模型

```
菜单级 → 页面级 → 元素级
```

| 层级 | 控制方式 | React 实现 |
| --- | --- | --- |
| **菜单级** | 根据角色动态生成侧边栏菜单 | `useRoleMenu` Hook 过滤路由配置 |
| **页面级** | 无权限页面显示 403 占位页 | 路由守卫组件 `<PermissionGuard>` |
| **元素级** | 按钮/操作列根据权限显示/隐藏 | `<Permission code="plan:approve">` 包裹组件 |

### 12.2 权限 UI 表现规则

* **无权限菜单**：直接隐藏（不显示灰色不可点击态，避免信息泄露）
* **无权限按钮**：隐藏而非禁用（除非业务上需要让用户知道该功能存在但当前不可用）
* **数据隔离**：终端用户仅看到本组织数据；内部角色可跨组织查看（按权限配置）
* **403 页面**：显示插画 + "您没有权限访问此页面" + "返回工作台"按钮

### 12.3 角色切换与多组织

* 若用户属于多个组织，TopBar 用户头像旁显示当前组织名称，点击可切换
* 切换组织后，菜单、数据、权限同步刷新

---

## 13. 数据可视化规范 (Data Visualization)

### 13.1 图表色板

图表配色基于品牌色扩展，确保色盲友好：

| 序号 | 色值 | 用途 |
| --- | --- | --- |
| 1 | `#0052CC` | 主数据系列（销量、收款） |
| 2 | `#00B8D9` | 辅助数据系列（计划量） |
| 3 | `#36B37E` | 正向指标（已完成、已到账） |
| 4 | `#FFAB00` | 中性/进行中指标 |
| 5 | `#FF5630` | 负向指标（异常、逾期） |
| 6 | `#6554C0` | 扩展系列 |

### 13.2 仪表盘组件规范

**KPI 数字卡片**：
* 布局：一行 3-4 个卡片，等宽排列
* 结构：图标（左）+ 数值（大号 DIN 字体，28px Bold）+ 标签（12px 灰色）+ 趋势箭头（可选）
* 可点击卡片：悬停显示阴影，点击钻取到对应列表

**资金水位条**（终端用户计划申报页）：
* 横向进度条，总宽度代表账户余额
* 分段着色：已占用（Warning Orange）+ 已冻结（LNG Blue）+ 可用（Success Green）
* 进度条上方显示各段金额数值
* 余额不足时可用段变为红色并闪烁

**履约看板（调度中心 Kanban）**：
* 4 列看板：待补录 → 待装车 → 运输中 → 待验收
* 每列显示订单数量徽章
* 卡片内容：订单号、客户、站点、预计时间
* 超时卡片：左侧红色竖条标记
* 支持拖拽排序（优先级调整，非状态变更）

### 13.3 图表类型与场景映射

| 业务场景 | 图表类型 | 说明 |
| --- | --- | --- |
| 气价趋势 | 折线图 | X 轴时间，Y 轴价格，支持多气源对比 |
| 资金结构 | 环形图 | 可用/占用/冻结三段 |
| 计划审批统计 | 柱状图 + 折线图 | 柱状=提交量，折线=通过率 |
| 磅差分布 | 直方图 | X 轴差值区间，Y 轴频次 |
| 收款账龄 | 堆叠柱状图 | 按账龄分段（30/60/90/90+天） |
| 订单履约时效 | 箱线图 / 柱状图 | 各环节耗时分布 |
| 当日运输概览 | 地图标注（可选） | 装车点/卸车点标注，运输路线（扩展） |

---

## 14. 响应式与自适应设计 (Responsive Design)

### 14.1 布局断点策略

| 断点 | 布局变化 |
| --- | --- |
| ≥ 1280px | 完整左右布局，侧边栏展开（宽度 240px） |
| 768px - 1279px | 侧边栏折叠为图标模式（宽度 64px），内容区自适应 |
| < 768px | 隐藏侧边栏，顶部汉堡菜单触发抽屉式导航；切换为移动端布局 |

### 14.2 栅格系统

* 基于 Ant Design Grid（24 栏栅格）
* 内容区最大宽度：1200px（居中），两侧留白 ≥ 24px
* 卡片布局：桌面端 3-4 列，平板 2 列，移动端 1 列
* 表格：桌面端完整列，平板端隐藏次要列（通过"展开行"查看），移动端转为卡片列表

### 14.3 移动端适配要点

* **触控热区**：所有可交互元素最小尺寸 44×44px
* **输入优化**：金额/吨位字段设置 `inputMode="decimal"`，唤起数字键盘
* **手势支持**：列表项左滑显示快捷操作（电话联系、导航）；下拉刷新
* **横屏处理**：磅单拍照页面支持横屏模式，提升拍摄体验
* **安全区域**：底部 Tab 栏适配 iPhone 底部安全区（`env(safe-area-inset-bottom)`）

---

## 15. 无障碍设计 (Accessibility)

### 15.1 基本要求（WCAG 2.1 AA）

* **色彩对比度**：正文文本与背景对比度 ≥ 4.5:1；大文本 ≥ 3:1
* **非色彩依赖**：状态不仅用颜色区分，同时使用图标/文字标签（如异常状态同时显示红色 + 感叹号图标 + "异常"文字）
* **键盘导航**：所有操作可通过 Tab/Enter/Esc 完成；焦点状态使用 2px 蓝色外边框
* **ARIA 标签**：图标按钮必须添加 `aria-label`；动态内容更新使用 `aria-live`
* **表单标签**：每个输入框必须关联 `<label>`；错误提示使用 `aria-describedby` 关联

### 15.2 高对比度模式（移动端户外场景）

* 提供"户外模式"开关（移动端设置页）
* 启用后：背景色加深为 `#FFFFFF`，文字色加深为 `#172B4D`，按钮边框加粗为 2px
* 状态徽章增加图案填充（斜线/点阵）辅助色彩辨识

---

## 16. 页面级交互规范补充 (Page-Level Specs)

> 补充第 5 节未覆盖的 SRS 模块页面交互细节。

### 16.1 注册与入驻 (SRS 模块 1)

**注册页**：
* 单页表单：手机号 + 验证码（Mock 固定码 888888）+ 密码 + 确认密码 + 组织类型（下拉）
* 组织类型选择后，页面下方动态显示该类型所需的资质清单提示

**资料提交页（分步表单）**：
* Step 1：基础信息（组织名称、统一社会信用代码、联系人、联系电话、开票信息）
* Step 2：资质上传（营业执照必传；危险品资质/运输资质按组织类型动态显示）
* Step 3：提交确认（信息摘要卡片 + 提交按钮）
* 每步均可"保存草稿"，下次登录继续填写

**审核工作台（气源发展）**：
* 列表页：Tab 切换（待审核 / 已通过 / 已驳回），支持按组织类型、提交日期筛选
* 详情页：左右分栏 — 左侧资料信息（含附件在线预览），右侧审核操作面板
* 审核操作：通过（可标记用户等级 A/B/C）/ 驳回（必填原因，支持原因模板）
* 通过后：显示"上传合同"入口，上传后用户状态变为"已激活"

### 16.2 基础信息管理 (SRS 模块 2)

**站点管理**：
* 列表 + 新增/编辑抽屉（Drawer）
* 字段：名称、类型（装车点/卸气点/用气点）、地址、联系人、电话、状态（启用/停用/维护中）
* 维护中状态需填写维护起止时间和原因
* 停用的站点在计划申报时不可选

**车辆/人员管理**：
* 列表页：资质有效期 ≤ 30 天的行显示橙色警告图标
* 资质过期的行显示红色标记，且在计划申报校验时阻止使用

### 16.3 气价管理 (SRS 模块 3)

**气价录入页（市场部）**：
* 表单字段：上游气源公司（下拉）、气源点（可选）、单价（数字输入）、有效期起止（日期范围选择器）、是否含税（开关）、适用范围（Radio：公共 / 指定客户）
* 选择"指定客户"时，展开客户多选下拉
* 操作：保存草稿 / 发布 / 下架
* 发布前校验：同一客户同一气源同一有效期内不允许多条已发布价格

**气价列表页（终端用户）**：
* 卡片式布局（非表格），每张卡片显示：气源公司、单价（大号数字）、有效期、备注
* 一户一价卡片右上角显示"专属价格"标签
* 卡片底部"申报计划"快捷按钮

### 16.4 用气计划申报详细交互 (SRS 模块 4)

**分步表单详细设计**：

*Step 1 — 基础信息*：
* 选择气价卡片（从可见气价中选择，选中态蓝色边框）
* 用气站点（下拉，仅显示启用且非维护中的站点）
* 计划日期 + 时间窗（日期选择器 + 时间范围）
* 计划量（数字输入，单位：吨）
* 输入计划量后，实时计算并显示"预计货款 = 计划量 × 单价"

*Step 2 — 履约方式*：
* Radio 选择：上游配送 / 用户自提 / 承运商配送
* 选择"用户自提"或"承运商配送"后，展开运输信息表单
* 承运商（下拉）、车辆（下拉，仅显示资质有效的车辆）、司机、押运员
* 选择车辆后自动带出罐容/载重信息，若计划量 > 载重则显示橙色提示

*Step 3 — 费用确认*：
* 信息摘要卡片：货款、承运费（可录入或按规则计算）、支付方式（预付/后付 Radio）
* 磅差处理原则（必选 Radio）：按装车量结算 / 按卸车量结算 / 差额多退少补
* **资金水位条**：可视化显示当前账户余额结构
* 若"可用余额 < 预计货款 + 承运费"：金额显示红色，提交按钮禁用，显示"余额不足，请先充值"提示

*Step 4 — 提交确认*：
* 全部信息只读摘要
* 勾选框："我已确认以上货款、承运费及磅差处理原则"（必勾）
* 提交按钮：勾选后点亮

**校验失败反馈**：
* 页面顶部 Alert 组件，列出所有不满足条件：
  * "❌ 车辆 [京A12345] 运输资质已过期（2026-01-15）"
  * "❌ 可用余额不足：需要 ¥120,000.00，当前可用 ¥80,000.00"
  * "❌ 站点 [XX卸气站] 当前处于维护中（2026-02-08 ~ 2026-02-12）"

### 16.5 计划审批详细交互 (SRS 模块 5)

**审批工作台**：
* 列表默认按"提交时间"倒序，"加急"标记的计划置顶并显示红色火焰图标
* 列表列：计划编号、客户名称、站点、计划量、预计货款、运输方式、提交时间、状态
* 行点击进入详情/审批

**审批详情页（分屏模式）**：
* 主区域（左 60%）：计划完整信息（只读），包含资质校验结果面板（绿色勾/红色叉逐项列出）
* 审批面板（右 40%，Drawer 或固定侧栏）：
  * 通过 / 退回 Radio
  * 退回原因（退回时必填）：下拉模板（"资质过期"、"余额不足"、"站点维护中"、"信息不完整"）+ 自定义补充文本框
  * 审批备注（可选）
  * 提交按钮

**卸气点维护配置**：
* 独立配置页：站点列表 + "设置维护"按钮
* 维护表单：站点、维护起止时间、原因、影响范围（Radio：禁止申报 / 允许申报但需人工确认）
* 生效后：终端用户申报页站点下拉中该站点显示"维护中"标签并置灰（禁止）或显示橙色提示（需确认）

### 16.6 订单补录与履约 (SRS 模块 6 & 7)

**订单补录页（调度中心）**：
* 关联计划（自动带入或手动选择）
* 补录字段：上游订单号、装车点、预计装车时间、运输方式确认
* 支持批量导入：下载模板 → 上传 Excel → 预览映射结果 → 确认导入
* 导入预览表格：正确行绿色背景，错误行红色背景 + 错误原因列

**履约看板（调度中心工作台）**：
* Kanban 四列布局（参见 13.2 节）
* 每列顶部：列标题 + 订单数量 Badge
* 卡片操作：点击进入详情；右键/长按显示快捷菜单（催办、标记异常）
* 超时规则可视化：超时 2 小时黄色标记，超时 4 小时红色标记

**装车/卸车确认页（移动端）**：
* 顶部：订单摘要卡片（订单号、客户、站点、计划量）
* 表单区：
  * 时间（默认当前时间，可修改）
  * 磅单号（文本输入）
  * 毛重 / 皮重 / 净重（数字输入，净重自动计算 = 毛重 - 皮重）
  * 装/卸车量（数字输入）
  * 磅单图片上传（拍照优先，支持相册选择）
* 底部固定操作栏："保存草稿" + "提交确认"

**磅差异常处理弹窗**：
* 触发条件：|装车量 - 卸车量| > 配置阈值
* 弹窗内容：
  * 红色警告横幅："检测到磅差异常（差值：-500kg）"
  * 装车磅单 vs 卸车磅单对比（左右并排，图片 + 关键数据）
  * 结算量调整：输入"最终结算量" + "处理备注"
  * 提交审核按钮

### 16.7 验收 (SRS 模块 8)

**验收工作台（调度中心）**：
* 列表：待验收订单，按送达时间排序
* 超过 24 小时未验收的订单显示橙色"超时"标记

**验收表单**：
* 验收结果：通过 / 不通过（Radio）
* 验收量（默认取已审核结算量，可修改）
* 气化率单上传（附件）
* 补充附件（可选）
* 验收备注
* 不通过时必须填写原因

### 16.8 资金管理 (SRS 模块 9 & 10)

**终端用户 — 账户余额页**：
* 顶部大数字卡片：总余额、可用余额、已占用、已冻结
* 资金结构环形图（可用/占用/冻结）
* 资金流水列表：时间、类型（预存/占用/冻结/释放/扣减）、金额（+/-）、关联单据、余额
* "预存登记"按钮（右上角）

**预存登记页**：
* 打款金额、打款时间（日期选择器）、回单附件上传
* 收款账户信息展示（只读，气源发展对公账户）
* 提交后状态：待财务确认

**财务收款工作台**：
* Tab 切换：预存待确认 / 订单待收款 / 异常
* 确认操作：确认到账 / 驳回（需填写原因）
* 确认后自动更新客户可用余额

**客户资金台账页（财务）**：
* 筛选：客户、时间范围
* 余额结构展示 + 流水明细表格
* 支持导出 Excel

### 16.9 对账与签章 (SRS 模块 11)

**对账单生成页（市场部）**：
* 选择维度：客户 + 周期（月度/半月/自定义日期范围）
* 预览：订单列表汇总（结算量、金额、付款状态、发票状态）
* 生成按钮 → 生成对账单 PDF 预览

**线上签章交互（Mock）**：
* 对账单/确认单详情页底部显示签章区域
* 气源发展侧："加盖公章"按钮 → 点击后播放盖章动画（印章从上方落下，0.4s）→ PDF 预览增加红色公章水印
* 终端用户侧：收到签章通知 → 查看确认单 → "确认并签章"按钮 → 同样盖章动画 → 状态变为"双方已确认"
* 签章日志：记录签章人、签章时间、IP（Mock）

**线下确认上传**：
* 上传扫描件/照片 + 填写确认日期
* 状态标记为"线下已确认"

### 16.10 发票管理 (SRS 模块 12)

**开票申请页（市场部）**：
* 可选范围：仅"已对账确认/已签章"的订单
* 多选订单 → 自动汇总开票金额
* 开票信息：抬头/税号（默认取客户档案，可修改）
* 优惠字段（占位）：是否存在周期优惠（开关）→ 优惠金额（手工录入）→ 实际开票金额 = 合计 - 优惠

**财务开票处理页**：
* 待开票列表 → 点击处理
* 录入：发票号码、金额、开票日期、税率
* 上传电子发票 PDF/图片（或 Mock 生成）
* 完成后关联到订单

**终端用户发票下载中心**：
* 按订单/按周期筛选
* 列表：发票号、金额、开票日期、关联订单、下载按钮
* 支持批量下载（打包 ZIP）

### 16.11 结算与报表 (SRS 模块 13 & 14)

**结算看板（财务）**：
* 顶部 KPI 卡片行：订单总数、已验收金额、已收款金额、未收款金额、已开票金额、异常订单数
* 筛选：周期、客户、上游公司
* 数据表格：逐单展示结算量、结算金额、付款记录、发票记录、磅差处理记录
* 上游付款记录（占位）：付款日期、金额、收款方、凭证附件

**报表页面**：
* 左侧报表目录树，右侧报表内容区
* 每个报表：筛选条件 + 图表 + 数据表格 + 导出按钮
* 报表列表参见 SRS 10.14 节（7 类报表）

### 16.12 归档管理 (SRS 模块 15)

* 归档列表：筛选条件（已结算/已开票/已对账确认）
* 操作：手动归档（批量支持）、取消归档（需权限）
* 归档后视觉标记：行背景浅灰色 + "已归档"徽章
* 归档后限制：核心字段只读，仅可追加附件/备注

### 16.13 异常处理中心 (SRS 模块 16)

**异常处理工作台**：
* Tab 切换：计划终止 / 订单终止 / 变更申请 / 多退少补
* 每个 Tab 下为列表 + 状态筛选

**计划/订单终止**：
* 发起终止：填写终止原因、责任方（下拉）、涉及金额
* 若已发生装车：必须上传相关单据
* 审批流程：提交 → 审批（市场部/调度主管）→ 通过后释放资金

**变更申请**：
* 变更内容：数量/时间/运输信息（勾选变更项）
* 变更前后对比：左右分栏，变更字段高亮显示
* 资金影响自动计算：追加占用 / 部分释放

**多退少补**：
* 差额单列表：需补收 / 需退款
* 需补收：进入应收列表，终端用户可查看
* 需退款：进入退款审批列表，审批通过后上传线下退款凭证（占位）

---

## 17. 状态管理与数据流 (State Management)

### 17.1 状态分层

| 状态类型 | 管理方案 | 示例 |
| --- | --- | --- |
| **服务端状态** | React Query (TanStack Query) | 计划列表、订单详情、气价数据 |
| **客户端全局状态** | Zustand | 当前用户信息、权限、组织、主题偏好 |
| **表单状态** | Ant Design Form / React Hook Form | 计划申报表单、审批表单 |
| **UI 局部状态** | React useState | 弹窗开关、Tab 切换、筛选展开 |

### 17.2 缓存与乐观更新策略

* **列表数据**：React Query 缓存 5 分钟，切换 Tab/筛选时优先展示缓存 + 后台刷新
* **审批操作**：乐观更新列表状态（立即从"待审批"移除），失败时回滚并 Toast 提示
* **文件上传**：上传完成后立即在本地展示缩略图，无需等待服务端确认
* **资金数据**：不使用乐观更新，始终等待服务端确认后刷新（资金安全优先）

### 17.3 路由结构

```
/login                          # 登录
/register                       # 注册
/onboarding                     # 资料提交

/app                            # 主布局（AdminLayout）
├── /dashboard                  # 工作台（按角色渲染不同内容）
├── /users                      # 用户管理
│   ├── /review                 # 入驻审核
│   └── /contracts              # 合同管理
├── /base-info                  # 基础信息
│   ├── /sites                  # 站点管理
│   ├── /vehicles               # 车辆管理
│   └── /personnel              # 人员管理
├── /gas-price                  # 气价管理
│   ├── /list                   # 气价列表
│   └── /edit/:id?              # 气价录入/编辑
├── /plans                      # 用气计划
│   ├── /list                   # 计划列表
│   ├── /create                 # 新建计划（分步表单）
│   ├── /:id                    # 计划详情
│   └── /approval               # 审批工作台
├── /orders                     # 订单中心
│   ├── /list                   # 订单列表
│   ├── /:id                    # 订单详情
│   ├── /supplement             # 订单补录
│   └── /fulfillment            # 履约看板
├── /acceptance                 # 验收管理
├── /finance                    # 资金管理
│   ├── /account                # 账户余额
│   ├── /deposit                # 预存登记
│   ├── /receipt                # 收款工作台
│   └── /ledger                 # 资金台账
├── /reconciliation             # 对账管理
│   ├── /statements             # 对账单
│   ├── /confirmations          # 确认单
│   └── /upstream               # 上游对账存档
├── /invoices                   # 发票管理
│   ├── /apply                  # 开票申请
│   ├── /process                # 开票处理
│   └── /download               # 发票下载
├── /settlement                 # 结算中心
├── /reports                    # 报表分析
├── /archive                    # 归档管理
├── /exceptions                 # 异常处理
│   ├── /termination            # 终止
│   ├── /changes                # 变更
│   └── /adjustments            # 多退少补
└── /messages                   # 消息中心

/mobile                         # 移动端布局（MobileLayout）
├── /home                       # 首页（任务卡片流）
├── /scan                       # 扫一扫
├── /tasks/:id/load             # 装车确认
├── /tasks/:id/unload           # 卸车确认
├── /messages                   # 消息
└── /profile                    # 我的
```

---

## 18. 弱网与离线策略 (Offline & Poor Network)

### 18.1 移动端弱网处理

* **提交超时（>10s）**：显示"网络不稳定，数据已保存到本地"Toast
* **本地暂存**：使用 IndexedDB 存储未提交的表单数据和已拍摄的磅单图片
* **自动重试**：网络恢复后自动上传暂存数据，上传成功后 Toast 通知
* **离线标记**：TopBar 显示"离线模式"橙色横幅，提醒用户当前数据可能不是最新

### 18.2 Web 端网络异常

* **请求失败**：Toast 提示"网络异常，请稍后重试" + 自动重试（最多 3 次）
* **会话过期**：弹出 Modal "登录已过期，请重新登录"，点击跳转登录页
* **大文件上传**：支持断点续传（分片上传），进度条显示已上传比例

---

## 19. 附录

### 19.1 状态徽章色彩映射总表

| 状态文本 | 背景色 | 文字色 | 适用场景 |
| --- | --- | --- | --- |
| 草稿 | `#F4F5F7` | `#42526E` | 计划、气价 |
| 待审核 / 审批中 | `#FFF0B3` | `#FF8B00` | 计划、入驻、订单 |
| 已通过 / 已批准 | `#E3FCEF` | `#006644` | 计划、入驻、验收 |
| 已驳回 / 退回 | `#FFEBE6` | `#BF2600` | 计划、入驻 |
| 执行中 / 运输中 | `#DEEBFF` | `#0747A6` | 订单 |
| 已完成 / 已结算 | `#E3FCEF` | `#006644` | 订单、结算 |
| 异常 | `#FFEBE6` | `#BF2600` | 磅差、资金 |
| 已归档 | `#F4F5F7` | `#97A0AF` | 订单 |
| 已取消 | `#F4F5F7` | `#97A0AF` | 计划、订单 |

### 19.2 编号格式规范

| 业务对象 | 编号格式 | 示例 |
| --- | --- | --- |
| 用气计划 | PL-YYYYMMDD-NNN | PL-20260209-001 |
| 订单 | OD-YYYYMMDD-NNN | OD-20260209-001 |
| 对账单 | RC-YYYYMM-NNN | RC-202602-001 |
| 确认单 | CF-YYYYMM-NNN | CF-202602-001 |
| 发票 | INV-YYYYMMDD-NNN | INV-20260209-001 |
| 异常单 | EX-YYYYMMDD-NNN | EX-20260209-001 |

### 19.3 建议实施优先级

基于业务频率与用户覆盖面，建议按以下顺序实施原型：

| 优先级 | 页面/模块 | 覆盖角色 |
| --- | --- | --- |
| P0 | 登录/注册、工作台（各角色） | 全部 |
| P0 | 气价浏览 + 计划申报（分步表单） | 终端用户 |
| P0 | 计划审批工作台 | 市场部 |
| P0 | 装车/卸车确认（移动端） | 司机/押运员 |
| P1 | 订单补录 + 履约看板 | 调度中心 |
| P1 | 收款工作台 + 客户资金台账 | 财务部 |
| P1 | 入驻审核 + 合同管理 | 市场部 |
| P2 | 对账单/确认单 + 签章 Mock | 市场部、终端用户 |
| P2 | 开票申请 + 发票下载 | 市场部、财务、终端用户 |
| P2 | 验收工作台 | 调度中心 |
| P3 | 结算看板 + 报表分析 | 财务部 |
| P3 | 归档管理 | 内部角色 |
| P3 | 异常处理中心 | 内部角色 |